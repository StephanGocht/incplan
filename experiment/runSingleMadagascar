#!/bin/bash
DIR="$1"
problemFile="$2"
option="$3"

problems="$DIR/../../../benchmarks/pddl/planning.domains.zip"

folder="$(dirname $problemFile)"

problem="$(basename $problemFile)"
problem="${problem%.*}"

domain="$(basename $folder)"

domainFile="$folder/domain.pddl"
domainFile2="${folder}/domain_${problem}.pddl"

case $option in
	"S")
		toolOption="-A 1 -S 1"
		conf="M"
	;;
	"P")
		toolOption=""
		conf="MpC"
	;;
	*)
	echo "unnown option"
	exit 1
	;;
esac

tool="$DIR/runMadagascar"

mkdir -p "$domain/$problem/$conf"
cd "$domain/$problem/$conf"
touch result

unzip -p $problems $domainFile > domain.pddl
#if empty use alternate location
if [ ! -s domain.pddl ] ; then
	unzip -p $problems $domainFile2 > domain.pddl
fi
unzip -p $problems $problemFile > problem.pddl

solver="$DIR/../bin/incplan-picosat961"

cmd="$tool problem.pddl $toolOption"
eval "/usr/bin/time -f 'completeTime=%e' timeout 5m $cmd" &> result
#rm -f domain.pddl problem.pddl output.sas problem.in problem.in.cnf problem.out