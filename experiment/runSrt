#!/bin/bash

run() {
	DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
	srt="java -jar $DIR/../bin/srt.jar"

	i=0
	splitPoint=0
	for param in "$@"
	do
	i=$((i + 1))
	case $param in
		::)
			splitPoint=$i
			;;
	esac
	done

	problem="${@:1:1}"

	if [ $splitPoint != 0 ]; then
		srtArgs="${@:2:$((splitPoint - 2))}"
		incplanArgs="${@:$((splitPoint + 1))}"

		incplanInput="problem.in"
		incplanOutput="problem.out"

		cmd="$srt $srtArgs $problem > $incplanInput"
		echo $cmd
		eval $cmd

		cmd="$incplanArgs $incplanInput | grep -v '^c' > $incplanOutput"
		echo $cmd
		/usr/bin/time -f "solvingTime=%e" bash -c "$cmd"

		cmd="$srt check $srtArgs $problem $incplanOutput"
		echo $cmd
		eval $cmd

	else
		echo "Srt cant solve problems alone please provide incplan"
	fi
}

export -f run

cmd="run $@"
/usr/bin/time -f "completeTime=%e"  bash -c "$cmd"